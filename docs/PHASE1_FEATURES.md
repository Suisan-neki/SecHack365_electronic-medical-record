# Phase 1: 基盤整備機能

## 📊 実装済み機能の詳細

### 1. データ品質管理機能

#### 概要
医療データの品質を自動的にチェックし、データの整合性を保証する機能です。

#### 主な機能
- **患者データ検証**: 必須フィールド、データ型、フォーマットのチェック
- **医療記録検証**: 診断内容、日付、関連性のチェック
- **整合性チェック**: 孤立した記録の検出、データ間の関連性確認
- **品質メトリクス**: 総合品質スコア、有効/無効データの統計

#### 品質チェック項目
- 必須フィールドの存在確認
- データ型の正確性
- 日付の妥当性（未来の日付でないか、1900年以降か）
- IDフォーマットの確認（患者ID: P###、記録ID: REC###）
- 性別の標準化（男性/女性/その他）

#### 使い方
1. 管理者ダッシュボードにログイン
2. 「Phase 1 機能管理」をクリック
3. 「データ品質管理」タブを選択
4. 品質スコアと検証結果を確認

### 2. 基本的な匿名化機能

#### 概要
医療データを段階的に匿名化し、プライバシーを保護しつつAI開発に活用できるデータセットを生成します。

#### 匿名化レベル

##### Level 1: 個人識別情報の削除
**削除される情報:**
- 名前（山下真凜 → 削除）
- 電話番号（090-1234-5678 → 削除）
- 詳細住所（東京都渋谷区恵比寿1-2-3 → 東京都）

**保持される情報:**
- 性別（女性）
- 年齢（22歳）
- 血液型（A型）
- アレルギー情報（なし）
- 都道府県（東京都）

**例:**
```json
{
  "anonymous_id": "ANON_A1B2C3D4",
  "gender": "女性",
  "age": 22,
  "blood_type": "A型",
  "allergies": "なし",
  "prefecture": "東京都"
}
```

##### Level 2: 仮名化
**Level 1に加えて:**
- 年齢を10歳刻みに（22歳 → 20-29歳）
- アレルギー情報を有無のみに（なし → false）
- 診断名を疾患カテゴリに（風邪 → 感染症）
- 日付を四半期に（2025-10 → 2025-Q4）

**例:**
```json
{
  "anonymous_id": "ANON_A1B2C3D4",
  "gender": "女性",
  "age_group": "20-29歳",
  "blood_type": "A型",
  "has_allergies": false,
  "prefecture": "東京都"
}
```

##### Level 3: 統計的匿名化
**Level 2に加えて:**
- 都道府県を地域に（東京都 → 関東）
- 四半期を年のみに（2025-Q4 → 2025）
- より広いカテゴリへの一般化

**例:**
```json
{
  "anonymous_id": "ANON_A1B2C3D4",
  "gender": "女性",
  "age_group": "20-29歳",
  "has_allergies": false,
  "region": "関東"
}
```

#### 使い方
1. 管理者ダッシュボードにログイン
2. 「Phase 1 機能管理」をクリック
3. 「匿名化機能」タブを選択
4. 匿名化レベルを選択
5. 「匿名化データをエクスポート」をクリック
6. JSONファイルがダウンロードされる

### 3. 患者同意管理システム

#### 概要
患者のデータ利用に関する同意を管理し、透明性と信頼性を確保する機能です。

#### 主な機能
- **同意の作成**: 患者が利用目的を選択して同意
- **同意の更新**: 後から利用目的や匿名化レベルを変更
- **同意の取り消し**: いつでも同意を撤回可能
- **同意統計**: 全体の同意状況を可視化

#### 利用目的
1. **医療・診療**: 診断、治療、処方などの医療行為
2. **医学研究**: 新しい治療法や診断法の開発
3. **AI開発**: 医療AIの学習データとして使用
4. **品質改善**: 医療サービスの品質向上
5. **統計分析**: 統計的な分析や研究

#### 匿名化レベルの選択
患者は自身のデータをどのレベルで匿名化するか選択できます：
- Level 1: 基本的な匿名化（年齢など一部情報を保持）
- Level 2: 仮名化（より一般化された情報）
- Level 3: 統計的匿名化（最も高いプライバシー保護）

#### 使い方
1. 管理者ダッシュボードにログイン
2. 「Phase 1 機能管理」をクリック
3. 「同意管理」タブを選択
4. 同意統計情報を確認

#### 同意統計の表示項目
- **総同意数**: 全患者数（現在: 3人）
- **有効な同意**: 同意している患者数（現在: 3人）
- **取り消し**: 同意を撤回した患者数（現在: 0人）
- **同意率**: 全体の同意率（現在: 100%）

## 🎯 Phase 1の成果

### データ品質の向上
- 全患者データが標準化され、検証済み
- 医療記録の整合性が確保された
- データエラーが0件

### プライバシー保護
- 3段階の匿名化レベルを提供
- 患者が自身のプライバシーレベルを選択可能
- AI開発に使える形式でデータを提供

### 透明性の確保
- 患者が同意した利用目的を明確に記録
- いつでも同意を撤回可能
- 同意状況を可視化

## 🚀 次のステップ（Phase 2）

Phase 1の基盤が整ったら、以下の機能を追加予定：

- 連合学習の実装
- ブロックチェーン基盤の構築
- 複数医療機関での協調学習
- プライバシー保護型AI学習

## 📚 技術仕様

### データ品質管理
- **モジュール**: `dummy_ehr_system/app/data_quality_manager.py`
- **検証ルール**: 必須フィールド、データ型、正規表現パターン
- **品質スコア**: (有効データ数 / 総データ数) × 100

### 匿名化機能
- **モジュール**: `dummy_ehr_system/app/anonymizer.py`
- **仮名生成**: SHA-256ハッシュを使用
- **地域マッピング**: 47都道府県 → 9地域

### 同意管理
- **モジュール**: `dummy_ehr_system/app/consent_manager.py`
- **ストレージ**: `dummy_ehr_system/data/patient_consents.json`
- **ログ**: `dummy_ehr_system/data/consent_logs.json`
